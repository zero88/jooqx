<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Untitled :: Reative SQL with Vert.x and jOOQ</title>
    <meta name="generator" content="Antora 3.0.1">
    <link rel="stylesheet" href="../../../_/css/site.css">
    <script>var uiRootPath = '../../../_'</script>
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="../../..">Reative SQL with Vert.x and jOOQ</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="#">Home</a>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Products</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Product A</a>
            <a class="navbar-item" href="#">Product B</a>
            <a class="navbar-item" href="#">Product C</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Services</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Service A</a>
            <a class="navbar-item" href="#">Service B</a>
            <a class="navbar-item" href="#">Service C</a>
          </div>
        </div>
        <div class="navbar-item">
          <span class="control">
            <a class="button is-primary" href="#">Download</a>
          </span>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="jooqx" data-version="main">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../index.html">jOOQ.x</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Core</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../index.html">Welcome</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../get-started.html">Get Started</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../installation.html">Installation</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../features.html">Features</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../apidocs.html">API docs</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Testing</span>
<ul class="nav-list">
  <li class="nav-item is-current-page" data-depth="1">
    <a class="nav-link" href="index.html">Development</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="apidocs.html">API docs</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">jOOQ.x</span>
    <span class="version">main</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <a class="title" href="../index.html">jOOQ.x</a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../index.html">main</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../rsql/main/index.html">RSQL</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../rsql/main/index.html">main</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../index.html">jOOQ.x</a></li>
    <li>Testing</li>
    <li><a href="index.html">Development</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="https://github.com/zero88/jooqx/edit/docs/main/antora/jooqx/modules/testing/pages/index.adoc">Edit this Page</a></div>
  </div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<div class="sect1">
<h2 id="_development"><a class="anchor" href="#_development"></a>Development</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_prerequisite"><a class="anchor" href="#_prerequisite"></a>Prerequisite</h3>
<div class="ulist">
<ul>
<li>
<p>Docker</p>
</li>
<li>
<p>Java</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_testing"><a class="anchor" href="#_testing"></a>Testing</h3>
<div class="paragraph">
<p>Out of the box, the integration test suite runs a <code>Docker database container</code>
using <a href="https://www.testcontainers.org/">TestContainers</a> or memory database (<code>H2</code>, <code>SQLite</code>)
on <a href="https://junit.org/junit5/">Junit5</a> and <a href="https://vertx.io/docs/vertx-junit5/java/">Vert.x Junit 5 integration</a> by
default.</p>
</div>
<div class="paragraph">
<p>Before test, it is required to generate <a href="integtest/src/test/resources">database schema</a> to <code>Java class</code> by <code>jOOQ</code>
codegen.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s begin</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">./generateJooq.sh

./gradlew build test</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_naming_rule"><a class="anchor" href="#_naming_rule"></a>Naming rule</h3>
<div class="paragraph">
<p><code>[DB][Type::3 char][Topic]Test</code></p>
</div>
<div class="paragraph">
<p>In which:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>DB</code> Database name: H2, Pg(PostgreSQL), MySQL, etcâ€¦</p>
</li>
<li>
<p><code>Type</code> is Legacy(<code>LeG</code>) or Reactive(<code>ReA</code>) JDBC client</p>
</li>
<li>
<p><code>Topic</code> is which topic for testing</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Examples:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>H2LeGRelTest</code>: <code>H2</code> Database <code>Legacy</code> JDBC <code>Relationship</code> Topic <code>Test</code></p>
</li>
<li>
<p><code>H2ReANumericTest</code>: <code>H2</code> Database <code>Reactive</code> JDBC <code>Numeric</code> Topic <code>Test</code></p>
</li>
<li>
<p><code>PgReATemporalTest</code>: <code>PostgreSQL</code> Database <code>Reactive</code> JDBC <code>temporal-data-type</code> topic <code>Test</code></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_how_to_write_new_test"><a class="anchor" href="#_how_to_write_new_test"></a>How to write new test</h3>
<div class="paragraph">
<p>To write new test or <code>MCVE</code> (Minimal Complete Verifiable Example) for a specific Database and on which JDBC
client (<code>legacy</code> or <code>reactive</code>) type, please use <code>jooqx-core</code> test fixtures. Also provide a suitable <code>database driver</code>
as a dependency.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Maven</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;dependency&gt;
  &lt;groupId&gt;io.github.zero88&lt;/groupId&gt;
  &lt;artifactId&gt;jooqx-core&lt;/artifactId&gt;
  &lt;version&gt;1.1.0-SNAPSHOT&lt;/version&gt;
  &lt;classifier&gt;testFixtures&lt;/classifier&gt;
  &lt;type&gt;jar&lt;/type&gt;
&lt;/dependency&gt;

&lt;!-- SQLite --&gt;
&lt;dependencies&gt;
&lt;dependency&gt;
  &lt;groupId&gt;org.xerial&lt;/groupId&gt;
  &lt;artifactId&gt;sqlite-jdbc&lt;/artifactId&gt;
  &lt;version&gt;3.34.0&lt;/version&gt;
&lt;/dependency&gt;
&lt;/dependencies&gt;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Gradle</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">api(testFixtures("io.github.zero88:jooqx-core:1.1.0-SNAPSHOT"))
// sqlite
api("org.xerial:sqlite-jdbc:3.34.0") )</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then you can extend some based classes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="core/src/testFixtures/java/io/zero88/jooqx/LegacyTestDefinition.java">LegacyTestDefinition</a></p>
</li>
<li>
<p><a href="core/src/testFixtures/java/io/zero88/jooqx/ReactiveTestDefinition.java">ReactiveTestDefinition</a></p>
</li>
<li>
<p><a href="core/src/testFixtures/java/io/zero88/jooqx/spi/pg/PgSQLReactiveTest.java">PgSQLReactiveTest</a></p>
</li>
<li>
<p><a href="core/src/testFixtures/java/io/zero88/jooqx/spi/pg/PgSQLReactiveTest.java">PgSQLReactiveTest</a></p>
</li>
<li>
<p><a href="core/src/testFixtures/java/io/zero88/jooqx/spi/mysql/MySQLReactiveTest.java">MySQLReactiveTest</a></p>
</li>
<li>
<p><a href="core/src/testFixtures/java/io/zero88/jooqx/spi/jdbc/JDBCReactiveProvider.java">JDBCReactiveProvider</a></p>
</li>
<li>
<p><a href="core/src/testFixtures/java/io/zero88/jooqx/spi/h2/H2DBProvider.java">H2DBProvider</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For <code>legacy JDBC</code>, you can extend base class <code>LegacyDBMemoryTest</code> or <code>LegacyDBContainerTest</code>. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">class H2LeGSomethingTest extends LegacyDBMemoryTest&lt;HikariCPDataSourceProvider&gt;
  implements H2DBProvider, H2SQLHelper, JDBCLegacyHikariProvider, UseJdbcErrorConverter {

  @Test
  void test_something(VertxTestContext ctx) {

  }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>For <code>reactive JDBC</code>, you can extend base class <code>ReactiveDBMemoryTest</code> or <code>ReactiveDBContainerTest</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">class PgReASomethingTest extends ReactiveDBContainerTest&lt;PgPool, PostgreSQLContainer&lt;?&gt;&gt;
  implements PgPoolProvider, PostgreSQLHelper, UsePgSQLErrorConverter {

  @Test
  void test_something(VertxTestContext ctx) {

  }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This is typical test that you should to try</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">class PgReARxTest extends PgSQLReactiveTest&lt;JDBCPool&gt;
    implements PgUseJooqType, JDBCReactiveProvider, UseJdbcErrorConverter, ReactiveRxHelper {

    @Override
    @BeforeEach
    public void tearUp(Vertx vertx, VertxTestContext ctx) {
        super.tearUp(vertx, ctx);
        this.prepareDatabase(ctx, this, connOpt, "pg_data/book_author.sql");
    }

    @Test
    void test_simple_rx(VertxTestContext ctx) {
        final io.zero88.jooqx.integtest.pgsql.tables.Books table = schema().BOOKS;
        Checkpoint cp = ctx.checkpoint();
        rxPool(jooqx).rxExecute(jooqx.dsl().selectFrom(table), DSLAdapter.fetchJsonRecords(table)).subscribe(recs -&gt; {
            ctx.verify(() -&gt; Assertions.assertEquals(7, recs.size()));
            cp.flag();
        }, ctx::failNow);
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Please checkout more in <a href="integtest">integtest project</a> to see in detail.</p>
</div>
</div>
</div>
</div>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <p>This page was built using the Antora default UI.</p>
  <p>The source code for this UI is licensed under the terms of the MPL-2.0 license.</p>
</footer>
<script src="../../../_/js/site.js"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
  </body>
</html>
